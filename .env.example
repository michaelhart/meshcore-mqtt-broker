# MeshCore MQTT Broker Configuration
# Copy this file to .env and fill in your values

# MQTT Server Settings
MQTT_WS_PORT=8883
MQTT_HOST=0.0.0.0

# Authentication Settings
# Expected audience claim in JWT tokens (e.g., mqtt.yourdomain.com)
# Leave empty to skip audience validation
AUTH_EXPECTED_AUDIENCE=mqtt.yourdomain.com

# Subscribe-Only Users (one per line, format: username:password:role)
# Role: 1=admin (full access + can delete retained), 2=full_access (no hidden data), 3=limited (filtered data)
# Default role is 3 (limited) if not specified
# Add as many as you need by incrementing the number
SUBSCRIBER_1=viewer1:your-secure-password-here:2
SUBSCRIBER_2=admin:admin-password-here:1
SUBSCRIBER_3=limited:limited-password:3
# ... add more as needed


# Abuse Detection - Enforcement
ABUSE_ENFORCEMENT_ENABLED=false

# Abuse Detection - Duplicate Detection
ABUSE_DUPLICATE_WINDOW_SIZE=100
ABUSE_DUPLICATE_WINDOW_MS=300000
ABUSE_DUPLICATE_THRESHOLD=10
ABUSE_MAX_DUPLICATES_PER_PACKET=5
ABUSE_DUPLICATE_RATE_THRESHOLD=0.3
ABUSE_DUPLICATE_RATE_WINDOW_MS=300000

# Abuse Detection - Rate Limiting
ABUSE_BUCKET_CAPACITY=20
ABUSE_BUCKET_REFILL_RATE=3

# Abuse Detection - Anomaly Detection
ABUSE_MAX_PACKET_SIZE=255
ABUSE_MAX_TOPICS_PER_DAY=3
ABUSE_ANOMALY_THRESHOLD=10

# Abuse Detection - IATA Change Limiting
ABUSE_MAX_IATA_CHANGES_24H=3

# Abuse Detection - Topic Tracking
ABUSE_TOPIC_HISTORY_SIZE=50
ABUSE_TOPIC_HISTORY_WINDOW_MS=86400000

# Abuse Detection - Persistence
ABUSE_PERSISTENCE_PATH=/data/abuse-detection.db
ABUSE_PERSISTENCE_INTERVAL_MS=300000

